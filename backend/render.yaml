# Cohort Summit - Render Deployment Configuration
# Last Updated: February 2026
# Application: Student Development & Management Platform

services:
  # Django Backend API Service
  - type: web
    name: cohort-summit-backend
    runtime: python
    plan: starter  # Change to 'standard' or higher for production
    region: oregon  # Change to your preferred region
    branch: main  # Deploy from main branch
    rootDir: backend  # Backend directory
    
    # Build Configuration
    buildCommand: |
      pip install --upgrade pip setuptools wheel
      pip install setuptools==69.5.1
      pip install -r requirements.txt
      python manage.py collectstatic --no-input
      python manage.py migrate --no-input
      python manage.py fix_user_sequence || true
      python manage.py create_production_users || true
      echo "=== DATABASE USERS ===" && python manage.py list_users || true
    
    # Start Command
    startCommand: |
      gunicorn config.wsgi:application --bind 0.0.0.0:$PORT --workers 4 --timeout 120 --access-logfile - --error-logfile -
    
    # Health Check
    healthCheckPath: /health/
    
    # Auto-Deploy
    autoDeploy: true
    
    # Environment Variables
    envVars:
      # Python Configuration
      - key: PYTHON_VERSION
        value: "3.12.2"
      
      # Django Core Settings
      - key: SECRET_KEY
        value: "cYG3+74E/HMQoiXhgkC4YqTequtJcVs2if+3jEP0XQQ="
        
      - key: DEBUG
        value: "False"
        
      - key: DJANGO_SETTINGS_MODULE
        value: config.settings
      
      # Allowed Hosts (comma-separated)
      - key: ALLOWED_HOSTS
        value: "cohort-backend-api.onrender.com,localhost,127.0.0.1"
        
      - key: CSRF_TRUSTED_ORIGINS
        value: "https://cohort-backend-api.onrender.com,https://*.onrender.com,https://cohort-summit-frontend-dpe.pages.dev"
      
      # CORS Configuration - Cloudflare Frontend
      - key: CORS_ALLOWED_ORIGINS
        value: "https://cohort-summit-frontend-dpe.pages.dev,http://localhost:5173,http://localhost:3000"
        
      - key: CORS_ALLOW_CREDENTIALS
        value: "True"
      
      # Supabase Database Connection - Direct connection (port 5432) to avoid IPv6 issues
      - key: DATABASE_URL
        value: "postgresql://postgres:Events%23sns%4034565@db.vkgycspcsybpgdsxjnnn.supabase.co:5432/postgres?sslmode=require"
      
      # Supabase Configuration
      - key: SUPABASE_URL
        value: "https://fvsnacsacvguindezvin.supabase.co"
        
      - key: SUPABASE_ANON_KEY
        value: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ2c25hY3NhY3ZndWluZGV6dmluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk4MDY4NzYsImV4cCI6MjA1NTM4Mjg3Nn0.yGmAsrON9dZMgiEBMyGpUZAimv4xCE6MQFkNZUwM23Mtl/k/G0GZRkQZMI2ERu8u6YZRbqvo2G9M5u7qyy0h3ptBUc"
        
      - key: SUPABASE_SERVICE_ROLE_KEY
        value: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ2c25hY3NhY3ZndWluZGV6dmluIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczOTgwNjg3NiwiZXhwIjoyMDU1MzgyODc2fQ.NMZ5YKmqh2Z5M8mdCfGlMTc3M1TqyN2zMWcII2XNviIbyMDqsfaTA2MgoaTZJelVr5tgn0t/0aS598NgB6H9ISJ7r2ONDMIN5r6rp3BS_DetNE"
        
      - key: SUPABASE_JWT_SECRET
        value: "5KdMurJ1xUozb0OtqpF+uZ7B1I5LHK0RRMTtU1nMA0AZzyiGfM7u/Qem1lmKroRf9YwBS0NiXjMmH1WirfTaggBVx+wQ=="
      
      # JWT Authentication
      - key: JWT_SECRET_KEY
        value: "Qsphh6x7bzzHTcNyuyc8DSXlva8y+0XGCE9m0znRdE4="
        
      - key: JWT_ALGORITHM
        value: "HS256"
        
      - key: JWT_ACCESS_TOKEN_LIFETIME_MINUTES
        value: "60"
        
      - key: JWT_REFRESH_TOKEN_LIFETIME_DAYS
        value: "7"
      
      # Email Configuration
      - key: EMAIL_BACKEND
        value: "django.core.mail.backends.smtp.EmailBackend"
        
      - key: EMAIL_HOST
        value: "smtp.gmail.com"
        
      - key: EMAIL_PORT
        value: "587"
        
      - key: EMAIL_USE_TLS
        value: "True"
        
      - key: EMAIL_HOST_USER
        value: "cohortmailservices@gmail.com"
        
      - key: EMAIL_HOST_PASSWORD
        value: "yfpl flst liox ichf"
      
      # LinkedIn OAuth (Optional - for IIPC module)
      - key: LINKEDIN_CLIENT_ID
        sync: false
        
      - key: LINKEDIN_CLIENT_SECRET
        sync: false
        
      - key: LINKEDIN_REDIRECT_URI
        sync: false
      
      # Media & Static Files
      - key: MEDIA_URL
        value: "/media/"
        
      - key: STATIC_URL
        value: "/static/"
      
      # Application Settings
      - key: MAX_UPLOAD_SIZE
        value: "10485760"  # 10MB in bytes
        
      - key: RATE_LIMIT
        value: "100/hour"
      
      # Deployment Environment
      - key: ENVIRONMENT
        value: "production"
        
      - key: RENDER
        value: "True"
    
    # Disk Storage for Media Files
    disk:
      name: cohort-media
      mountPath: /opt/render/project/src/media
      sizeGB: 5  # Adjust based on your needs

# Note: Database is managed by Supabase (not Render)
# Connection string is configured in DATABASE_URL environment variable above
