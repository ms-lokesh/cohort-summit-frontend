# Cohort Summit - Render Deployment Configuration
# Last Updated: February 2026
# Application: Student Development & Management Platform

services:
  # Django Backend API Service
  - type: web
    name: cohort-summit-backend
    runtime: python
    plan: starter  # Change to 'standard' or higher for production
    region: oregon  # Change to your preferred region
    branch: main  # Deploy from main branch
    rootDir: backend  # Backend directory
    
    # Build Configuration
    buildCommand: |
      pip install --upgrade pip setuptools wheel
      pip install setuptools==69.5.1
      pip install -r requirements.txt
      python manage.py collectstatic --no-input
      python manage.py migrate --no-input
      python manage.py create_production_users || true
      python manage.py list_users || true
    
    # Start Command
    startCommand: |
      gunicorn config.wsgi:application --bind 0.0.0.0:$PORT --workers 4 --timeout 120 --access-logfile - --error-logfile -
    
    # Health Check
    healthCheckPath: /health/
    
    # Auto-Deploy
    autoDeploy: true
    
    # Environment Variables
    envVars:
      # Python Configuration
      - key: PYTHON_VERSION
        value: "3.12"
      
      # Django Core Settings
      - key: SECRET_KEY
        generateValue: true
        
      - key: DEBUG
        value: "False"
        
      - key: DJANGO_SETTINGS_MODULE
        value: config.settings
      
      # Allowed Hosts (comma-separated)
      - key: ALLOWED_HOSTS
        value: ".onrender.com,localhost,127.0.0.1"
        
      - key: CSRF_TRUSTED_ORIGINS
        value: "https://*.onrender.com"
      
      # CORS Configuration
      - key: CORS_ALLOWED_ORIGINS
        value: "https://your-frontend-domain.com,http://localhost:5173,http://localhost:3000"
        
      - key: CORS_ALLOW_CREDENTIALS
        value: "True"
      
      # Database Connection
      - key: DATABASE_URL
        fromDatabase:
          name: cohort-summit-db
          property: connectionString
      
      # JWT Authentication
      - key: JWT_SECRET_KEY
        generateValue: true
        
      - key: JWT_ACCESS_TOKEN_LIFETIME
        value: "60"  # minutes
        
      - key: JWT_REFRESH_TOKEN_LIFETIME
        value: "1440"  # 24 hours in minutes
      
      # Email Configuration (Optional - configure as needed)
      - key: EMAIL_BACKEND
        value: django.core.mail.backends.console.EmailBackend
        
      - key: EMAIL_HOST
        sync: false  # Set in Render dashboard
        
      - key: EMAIL_PORT
        value: "587"
        
      - key: EMAIL_USE_TLS
        value: "True"
        
      - key: EMAIL_HOST_USER
        sync: false
        
      - key: EMAIL_HOST_PASSWORD
        sync: false
      
      # LinkedIn OAuth (Optional - for IIPC module)
      - key: LINKEDIN_CLIENT_ID
        sync: false
        
      - key: LINKEDIN_CLIENT_SECRET
        sync: false
        
      - key: LINKEDIN_REDIRECT_URI
        sync: false
      
      # Media & Static Files
      - key: MEDIA_URL
        value: /media/
        
      - key: STATIC_URL
        value: /static/
      
      # Application Settings
      - key: MAX_UPLOAD_SIZE
        value: "10485760"  # 10MB in bytes
        
      - key: RATE_LIMIT
        value: "100/hour"
      
      # Deployment Environment
      - key: ENVIRONMENT
        value: production
        
      - key: RENDER
        value: "True"
    
    # Disk Storage for Media Files
    disk:
      name: cohort-media
      mountPath: /opt/render/project/src/media
      sizeGB: 5  # Adjust based on your needs

# Database Service
databases:
  - name: cohort-summit-db
    databaseName: cohort_summit_db
    user: cohort_user
    plan: starter  # Change to 'standard' or higher for production
    region: oregon  # Should match web service region
    
    # PostgreSQL Version
    postgresMajorVersion: "15"
    
    # Backup & Maintenance
    # Note: Automatic backups available on paid plans
